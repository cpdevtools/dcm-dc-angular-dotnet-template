"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createRepo = exports.cloneRepo = exports.configureGithubCli = exports.githubAuthStatus = exports.githubLogin = void 0;
const chalk_1 = require("./chalk");
const cmd_1 = require("./cmd");
async function githubLogin(...args) {
    const chalk = await (0, chalk_1.importChalk)();
    if (args.length === 2) {
        console.info(`Attempting to log into github.com with user ${chalk.yellowBright(args[0])}`);
        const result = await (0, cmd_1.exec)(`echo "${args[1]}" | gh auth login --with-token`);
        return !result;
    }
    const result = await (0, cmd_1.exec)(`GITHUB_TOKEN="${args[0]}"; gh auth login -h github.com`);
    console.log(result);
    return !result;
}
exports.githubLogin = githubLogin;
async function githubAuthStatus() {
    console.info(`Checking Github Cli auth status`);
    const result = await (0, cmd_1.run)(`gh auth status -t`);
    const usernameRegExp = /Logged in to github\.com as ([\w\d]+)/i;
    const usernameMatch = result.match(usernameRegExp);
    const username = usernameMatch?.[1];
    const protocolRegExp = /configured to use ([\w]+) protocol/i;
    const protocolMatch = result.match(protocolRegExp);
    const protocol = protocolMatch?.[1];
    const tokenRegExp = /Token: ([\w\d\*]+)/i;
    const tokenMatch = result.match(tokenRegExp);
    const token = tokenMatch?.[1];
    const scopesRegExp = /Token scopes: (.*?)$/im;
    const scopesMatch = result.match(scopesRegExp);
    const scopes = scopesMatch?.[1]?.split(",").map((s) => s.trim());
    return {
        username,
        protocol,
        token,
        scopes,
    };
}
exports.githubAuthStatus = githubAuthStatus;
async function configureGithubCli() {
    console.info(`Configuring Github Cli`);
    await (0, cmd_1.exec)(`gh config set git_protocol https -h github.com`);
    await (0, cmd_1.exec)(`gh auth setup-git`);
}
exports.configureGithubCli = configureGithubCli;
async function cloneRepo(id, path, opts) {
    await (0, cmd_1.exec)(`gh repo clone ${id} ${path ?? ""}`, { cwd: opts?.cwd });
}
exports.cloneRepo = cloneRepo;
async function createRepo(id, opts) {
    const cmd = [`gh repo create ${id}`];
    if (opts?.clone) {
        cmd.push(`--clone`);
    }
    if (opts?.description) {
        cmd.push(`--description "${opts?.description}"`);
    }
    if (opts?.disableIssues) {
        cmd.push(`--disable-issues`);
    }
    if (opts?.disableWiki) {
        cmd.push(`--disable-wiki`);
    }
    if (opts?.gitIgnore) {
        cmd.push(`--gitignore "${opts?.gitIgnore}"`);
    }
    if (opts?.homepage) {
        cmd.push(`--homepage "${opts?.homepage}"`);
    }
    if (opts?.includeAllBranches) {
        cmd.push(`--include-all-branches`);
    }
    if (opts?.internal) {
        cmd.push(`--internal`);
    }
    if (opts?.license) {
        cmd.push(`--license "${opts?.license}"`);
    }
    if (opts?.private) {
        cmd.push(`--private`);
    }
    if (opts?.public) {
        cmd.push(`--public`);
    }
    if (opts?.push) {
        cmd.push(`--push`);
    }
    if (opts?.remote) {
        cmd.push(`--remote "${opts?.remote}"`);
    }
    if (opts?.source) {
        cmd.push(`--source "${opts?.source}"`);
    }
    if (opts?.team) {
        cmd.push(`--team "${opts?.team}"`);
    }
    if (opts?.template) {
        cmd.push(`--template "${opts?.template}"`);
    }
    await (0, cmd_1.exec)(cmd.join(" "), { cwd: opts?.cwd });
}
exports.createRepo = createRepo;
/*
export async function searchRepos() {
  const a = new Octokit({auth: process.env.GITHUB_TOKEN});

  return await a.repos.listForAuthenticatedUser({type: 'all', });
}
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2l0aHViLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL2dpdGh1Yi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxtQ0FBc0M7QUFDdEMsK0JBQWtDO0FBK0UzQixLQUFLLFVBQVUsV0FBVyxDQUFDLEdBQUcsSUFBYztJQUNqRCxNQUFNLEtBQUssR0FBRyxNQUFNLElBQUEsbUJBQVcsR0FBRSxDQUFDO0lBQ2xDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDckIsT0FBTyxDQUFDLElBQUksQ0FBQywrQ0FBK0MsS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDM0YsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLFVBQUksRUFBQyxTQUFTLElBQUksQ0FBQyxDQUFDLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUM1RSxPQUFPLENBQUMsTUFBTSxDQUFDO0tBQ2hCO0lBQ0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLFVBQUksRUFBQyxpQkFBaUIsSUFBSSxDQUFDLENBQUMsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ3BGLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEIsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUNqQixDQUFDO0FBVkQsa0NBVUM7QUFTTSxLQUFLLFVBQVUsZ0JBQWdCO0lBQ3BDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztJQUVoRCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsU0FBRyxFQUFDLG1CQUFtQixDQUFDLENBQUM7SUFFOUMsTUFBTSxjQUFjLEdBQUcsd0NBQXdDLENBQUM7SUFDaEUsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNuRCxNQUFNLFFBQVEsR0FBRyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENB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